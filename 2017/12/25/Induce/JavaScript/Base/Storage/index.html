<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="JavaScript," />





  <link rel="alternate" href="/atom.xml" title="Luuman's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="概况离线Web应用，就是在设备不能上网的情况下，仍然可以运行的应用。HTML5把离线应用作为重点。 ！！！！未完成IndexedDB">
<meta name="keywords" content="JavaScript">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript 本地存储">
<meta property="og:url" content="http://luuman.github.io/2017/12/25/Induce/JavaScript/Base/Storage/index.html">
<meta property="og:site_name" content="Luuman&#39;s Blog">
<meta property="og:description" content="概况离线Web应用，就是在设备不能上网的情况下，仍然可以运行的应用。HTML5把离线应用作为重点。 ！！！！未完成IndexedDB">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-01-16T09:27:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript 本地存储">
<meta name="twitter:description" content="概况离线Web应用，就是在设备不能上网的情况下，仍然可以运行的应用。HTML5把离线应用作为重点。 ！！！！未完成IndexedDB">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://luuman.github.io/2017/12/25/Induce/JavaScript/Base/Storage/"/>





  <title> JavaScript 本地存储 | Luuman's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Luuman's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">因为有了危机感，所以会义无反顾。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://luuman.github.io/2017/12/25/Induce/JavaScript/Base/Storage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="世平阜康">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Luuman's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                JavaScript 本地存储
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-25T18:29:00+08:00">
                2017-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h1><p>离线Web应用，就是在设备不能上网的情况下，仍然可以运行的应用。HTML5把离线应用作为重点。</p>
<p>！！！！未完成IndexedDB<br><a id="more"></a></p>
<h1 id="离线检测"><a href="#离线检测" class="headerlink" title="离线检测"></a>离线检测</h1><h2 id="navigator-onLine"><a href="#navigator-onLine" class="headerlink" title="navigator.onLine"></a>navigator.onLine</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (navigator.onLine) &#123;</div><div class="line">	<span class="comment">// 正常工作</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">	<span class="comment">// 执行离线状态时的任务</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>兼容性：</p>
<ol>
<li>IE6+和Safari5+能够正确检测</li>
</ol>
<h2 id="网络判断"><a href="#网络判断" class="headerlink" title="网络判断"></a>网络判断</h2><h3 id="事件判断"><a href="#事件判断" class="headerlink" title="事件判断"></a>事件判断</h3><p>可以使用HTML5事件判断：online、offline</p>
<ul>
<li><a href="https://caniuse.com/#search=online" target="_blank" rel="external">兼容性</a></li>
</ul>
<p>支持离线检测的浏览器有IE6+（只支持navigator.onLine）、Firefox3、Safari4、Opera10.6、Chrome、iOS3.2版Safari和Android版WebKit。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> EventUtil = &#123;</div><div class="line">    <span class="attr">addHandler</span>: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (element.addEventListener) &#123;</div><div class="line">            element.addEventListener(type, handler, <span class="literal">false</span>)</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent) &#123;</div><div class="line">            element.attachEvent(<span class="string">'on'</span> + type, handler)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            element[<span class="string">'on'</span> + type] = handler</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">removeHandler</span>: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (element.removeEventListener) &#123;</div><div class="line">            element.removeEventListener(type, handler, <span class="literal">false</span>)</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.detachEvent) &#123;</div><div class="line">            element.detachEvent(<span class="string">'on'</span> + type, handler)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            element[<span class="string">'on'</span> + type] = <span class="literal">null</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getEvent</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> event ? event : <span class="built_in">window</span>.event</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getTarget</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> event.target || event.srcElement</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">preventDefault</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (event.preventDefault) &#123;</div><div class="line">            event.preventDefault()</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            event.returnValue = <span class="literal">false</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">stopPropagation</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (event.stopPropagation) &#123;</div><div class="line">            event.stopPropagation()</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            event.cancelBubbles = <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getRelatedTarget</span>: <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (event.relatedTarger) &#123;</div><div class="line">            <span class="keyword">return</span> event.relatedTarget</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event.toElement) &#123;</div><div class="line">            <span class="keyword">return</span> event.toElement</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event.fromElement) &#123;</div><div class="line">            <span class="keyword">return</span> event.fromElement</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">null</span> &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">"online"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	alert(<span class="string">"online"</span>)</div><div class="line">&#125;)</div><div class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">"offline"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="string">"Offline"</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>总之在IE和Firefox中一般情况下不能触发这俩事件，只有在选择脱机状态下才能触发此事件。(存在兼容问题)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> status = <span class="built_in">document</span>.getElementById(<span class="string">'status'</span>);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">updateOnlineStatus</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> condition = navigator.onLine ? <span class="string">'online'</span> : <span class="string">'offline'</span></div><div class="line">        status.className = condition</div><div class="line">        status.innerHTML = condition.toUpperCase()</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'online'</span>,  updateOnlineStatus)</div><div class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'offline'</span>, updateOnlineStatus)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="图片轮询"><a href="#图片轮询" class="headerlink" title="图片轮询"></a>图片轮询</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;!-- jquery --&gt;</div><div class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> imgD = $(<span class="string">'&lt;img src="https://www.baidu.com/favicon.ico?'</span>+(<span class="keyword">new</span> <span class="built_in">Date</span>())+<span class="string">'"&gt;'</span>)</div><div class="line">    imgD.appendTo(<span class="string">'body'</span>).css(<span class="string">'display'</span>,<span class="string">'none'</span>).load(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'连接成功！'</span>)</div><div class="line">        $(<span class="keyword">this</span>).remove()</div><div class="line">    &#125;).error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'断网了！'</span>)</div><div class="line">        $(<span class="keyword">this</span>).remove()</div><div class="line">    &#125;)</div><div class="line">&#125;,<span class="number">2000</span>)</div><div class="line"></div><div class="line">&lt;!-- js --&gt;</div><div class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> div = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</div><div class="line">	div.id = <span class="string">"mDiv"</span>;</div><div class="line">	<span class="keyword">let</span> isLoad = <span class="literal">false</span></div><div class="line">	div.src = <span class="string">'https://www.baidu.com/favicon.ico?'</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>())</div><div class="line">	div.style.display = <span class="string">'none'</span></div><div class="line">	div.innerHTML = <span class="string">"新元素"</span>;</div><div class="line">	div.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		isLoad = <span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (isLoad) &#123;</div><div class="line">	  <span class="built_in">console</span>.log(<span class="string">'连接成功！'</span>)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">	  <span class="built_in">console</span>.log(<span class="string">'断网了！'</span>)</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">document</span>.body.appendChild(div);</div><div class="line">&#125;)</div><div class="line">有个问题请求的延迟问题</div><div class="line"></div><div class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">let</span> image = <span class="keyword">new</span> Image()</div><div class="line">	<span class="keyword">let</span> isLoad = <span class="literal">false</span></div><div class="line">	<span class="comment">// image.crossOrigin = ''</span></div><div class="line">	image.src = <span class="string">'https://www.baidu.com/favicon.ico?'</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>())</div><div class="line">	image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	  <span class="built_in">console</span>.log(<span class="string">'连接成功！'</span>)</div><div class="line">	&#125;</div><div class="line">	image.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	  <span class="built_in">console</span>.log(<span class="string">'断网了！'</span>)</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Ajax轮询"><a href="#Ajax轮询" class="headerlink" title="Ajax轮询"></a>Ajax轮询</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//Ajax...</span></div><div class="line">&#125;,<span class="number">1000</span>)</div></pre></td></tr></table></figure>
<h1 id="应用缓存（已废弃）"><a href="#应用缓存（已废弃）" class="headerlink" title="应用缓存（已废弃）"></a>应用缓存（已废弃）</h1><h1 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h1><p>在客户端(浏览器端)存储数据有诸多益处，最主要的一点是能快速访问(网页)数据。(以往)在客户端有五种数据存储方法，而目前就只有四种常用方法了(其中一种被废弃了)：</p>
<ol>
<li>Cookies</li>
<li>Local Storage</li>
<li>Session Storage</li>
<li>IndexedDB</li>
<li>WebSQL (被废弃)</li>
</ol>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><p>Cookies 是一种在文档内存储字符串数据最典型的方式。<br>一般而言，cookies 会由服务端发送给客户端，客户端存储下来，然后在随后让请求中再发回给服务端。这可以用于诸如管理用户会话，追踪用户信息等事情。<br>此外，客户端也用使用 cookies 存储数据。因而，cookies 常被用于存储一些通用的数据，如用户的首选项设置。</p>
<h3 id="构成"><a href="#构成" class="headerlink" title="构成"></a>构成</h3><table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>唯一确定cookie的名称（不区分大小写）名称必须经过URL编码</td>
</tr>
<tr>
<td>Value</td>
<td>存储的字符串值，必须经过URL编码</td>
</tr>
<tr>
<td>Domain</td>
<td>对哪个域是有效的</td>
</tr>
<tr>
<td>Path</td>
<td>对于指定域中的那个路径</td>
</tr>
<tr>
<td>Expires/Max-Age</td>
<td>何时应该被删除的时间戳</td>
</tr>
<tr>
<td>secure</td>
<td>secure标志</td>
</tr>
</tbody>
</table>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Create 创建</span></div><div class="line"><span class="built_in">document</span>.cookie = <span class="string">"user_name = Ire Aderinokun"</span></div><div class="line"><span class="built_in">document</span>.cookie = <span class="string">"user_age = 25; max-age = 31536000; secure"</span></div><div class="line"></div><div class="line"><span class="comment">// Read (All) 读取</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.cookie)</div><div class="line"></div><div class="line"><span class="comment">// Update 更新</span></div><div class="line"><span class="built_in">document</span>.cookie = <span class="string">"user_age = 24;max-age = 31536000; secure"</span></div><div class="line"></div><div class="line"><span class="comment">// Delete 删除</span></div><div class="line"><span class="built_in">document</span>.cookie = <span class="string">"user_name = Ire Aderinokun; expires = Thu, 01 Jan 1970 00:00:01 GMT"</span></div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Domain</th>
<th>Path</th>
<th>Expires/Max-Age</th>
<th>Size</th>
<th>HTTP</th>
<th>secure</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_name</td>
<td>Ire Aderinokun</td>
<td></td>
<td>/</td>
<td>Session</td>
<td>23</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>user_age</td>
<td>25</td>
<td></td>
<td>/</td>
<td>2018-12-29T05:47:09.605Z</td>
<td>10</td>
<td></td>
<td>✓</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="HTTP专有cookie"><a href="#HTTP专有cookie" class="headerlink" title="HTTP专有cookie"></a>HTTP专有cookie</h3><p>HTTP专有cookie可以从浏览器或服务器设置，但是只能从服务器端读取，因为JavaScript无法获取HTTP专有cookie的值</p>
<blockquote>
<p>在IE5.0 中自定义行为引入了持久化用户数据</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;div style=<span class="string">"behavior:url(#default#userData)"</span> id=<span class="string">"dataStore"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">&lt;!-- 使用CSS在某个元素上指定userData行为，就可以使用setAttribute()保存上面的数据 --&gt;</div><div class="line"></div><div class="line"><span class="xml"><span class="comment">&lt;!-- 设置 --&gt;</span></span></div><div class="line">var dataStore = document.getElementById("dataStore")</div><div class="line">dataStore.setAttribute("name", "Nicholas")</div><div class="line">dataStore.setAttribute("book", "Professional JavaScript")</div><div class="line">dataStore.save("BookInfo")</div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 获取 --&gt;</span></div><div class="line">dataStore.load("BookInfo")</div><div class="line">alert(dataStore.getAttribute("name"))</div><div class="line">//"Nicholas"</div><div class="line">alert(dataStore.getAttribute("book"))</div><div class="line">//"Professional JavaScript"</div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 删除 --&gt;</span></div><div class="line">dataStore.removeAttribute("name")</div><div class="line">dataStore.removeAttribute("book")</div><div class="line">dataStore.save("BookInfo")</div></pre></td></tr></table></figure>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ol>
<li>能用于和服务端通信，极高的扩展性和可用性</li>
<li>当<code>cookie</code>快要自动过期时，我们可以重新设置而不是删除</li>
<li>通过良好的编程，控制保存在cookie中的session对象的大小。</li>
<li>通过加密和安全传输技术（SSL），减少cookie被破解的可能性。</li>
<li>只在cookie中存放不敏感数据，即使被盗也不会有重大损失。</li>
<li>控制cookie的生命期，使之不会永远有效。偷盗者很可能拿到一个过期的cookie。</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>增加了文档传输的负载</li>
<li>只能存储少量的数据</li>
<li>只能存储字符串</li>
<li>潜在的安全问题</li>
<li>自从有 Web Storage API (Local and Session Storage)，cookies 就不再被推荐用于存储数据了</li>
<li><code>Cookie</code>数量和长度的限制。每个domain最多只能有20条cookie，每个cookie长度不能超过4KB，否则会被截掉。</li>
<li>安全性问题。如果cookie被人拦截了，那人就可以取得所有的session信息。即使加密也与事无补，因为拦截者并不需要知道cookie的意义，他只要原样转发cookie就可以达到目的了。</li>
<li>有些状态不可能保存在客户端。例如，为了防止重复提交表单，我们需要在服务器端保存一个计数器。如果我们把这个计数器保存在客户端，那么它起不到任何作用。</li>
</ol>
<ul>
<li><a href="https://github.com/jaaulde/cookies" target="_blank" rel="external">cookies</a></li>
<li><a href="https://github.com/franciscop/cookies.js?utm_source=codropscollective" target="_blank" rel="external">cookies.js</a></li>
<li><a href="https://www.jianshu.com/p/a55969e078fb" target="_blank" rel="external">源码分析之：cookies.js</a></li>
<li><a href="https://github.com/dwqs/blog/issues/42" target="_blank" rel="external">客户端(浏览器端)数据存储技术概览</a></li>
</ul>
<h2 id="cookies-js"><a href="#cookies-js" class="headerlink" title="cookies.js"></a>cookies.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> cookies = <span class="function"><span class="keyword">function</span> (<span class="params">data, opt</span>) </span>&#123;</div><div class="line">	<span class="comment">// 一个合并对象属性的方法，和Object.assign有些类似</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaults</span> (<span class="params">obj, defs</span>) </span>&#123;</div><div class="line">    obj = obj || &#123;&#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> defs) &#123;</div><div class="line">	    <span class="comment">// 对象属性不存在时，进行浅拷贝</span></div><div class="line">      <span class="keyword">if</span> (obj[key] === <span class="literal">undefined</span>) &#123;</div><div class="line">        obj[key] = defs[key]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> obj</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 初始化配置</span></div><div class="line">  defaults(cookies, &#123;</div><div class="line">	  <span class="comment">// 时效一年</span></div><div class="line">    expires: <span class="number">365</span> * <span class="number">24</span> * <span class="number">3600</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">    <span class="comment">// https协议类型</span></div><div class="line">    secure: <span class="built_in">window</span>.location.protocol === <span class="string">'https:'</span>,</div><div class="line">    <span class="comment">// Advanced，详见 https://github.com/franciscop/cookies.js#advanced-options</span></div><div class="line">    <span class="comment">// 将cookie的值设置为null以移除它</span></div><div class="line">    nulltoremove: <span class="literal">true</span>,</div><div class="line">    <span class="comment">// 用JSON编码和解码数据结构</span></div><div class="line">    autojson: <span class="literal">true</span>,</div><div class="line">    <span class="comment">// 编码使其安全的URL（rfc6265）</span></div><div class="line">    autoencode: <span class="literal">true</span>,</div><div class="line">    <span class="comment">// 函数对它进行编码</span></div><div class="line">    encode: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(val)</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 函数对它进行解码</span></div><div class="line">    decode: <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(val)</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">fallback</span>: <span class="literal">false</span></div><div class="line">  &#125;)</div><div class="line">  opt = defaults(opt, cookies)</div><div class="line">  <span class="comment">// 时间计算</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">expires</span> (<span class="params">time</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> expires = time</div><div class="line">    <span class="keyword">if</span> (!(expires <span class="keyword">instanceof</span> <span class="built_in">Date</span>)) &#123;</div><div class="line">      expires = <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">      expires.setTime(expires.getTime() + (time * <span class="number">1000</span>))</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> expires.toUTCString()</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 查询cookie</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> data === <span class="string">'string'</span>) &#123;</div><div class="line">	  <span class="comment">// 分割document.cookie中的每个cookie</span></div><div class="line">    <span class="keyword">var</span> value = <span class="built_in">document</span>.cookie.split(<span class="regexp">/;\s*/</span>)</div><div class="line">	    <span class="comment">// 如果autoencode为true，则数组中的每个cookie通过decode进行处理，否则直接返回</span></div><div class="line">      .map(opt.autoencode ? opt.decode : <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d &#125;)</div><div class="line">      <span class="comment">// 再将每个cookie分割成[ key, value ]的结构</span></div><div class="line">      .map(<span class="function"><span class="keyword">function</span> (<span class="params">part</span>) </span>&#123; <span class="keyword">return</span> part.split(<span class="string">'='</span>) &#125;)</div><div class="line">      <span class="comment">// 新建对象，将[ [ key1, value1 ], [ key2, value2 ] ]结构</span></div><div class="line">      <span class="comment">// 转换为&#123; key1: value1, key2: value2 &#125;结构</span></div><div class="line">      .reduce(<span class="function"><span class="keyword">function</span> (<span class="params">parts, part</span>) </span>&#123;</div><div class="line">        parts[part[<span class="number">0</span>]] = part.splice(<span class="number">1</span>).join(<span class="string">'='</span>)</div><div class="line">        <span class="keyword">return</span> parts</div><div class="line">      &#125;, &#123;&#125;)[data]</div><div class="line">    <span class="comment">// 获取指定cookie值，将值赋给value</span></div><div class="line">    <span class="comment">// 是否将json字串转换为object输出</span></div><div class="line">    <span class="keyword">if</span> (!opt.autojson) <span class="keyword">return</span> value</div><div class="line">    <span class="keyword">var</span> real</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      real = <span class="built_in">JSON</span>.parse(value)</div><div class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">      real = value</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> real === <span class="string">'undefined'</span> &amp;&amp; opt.fallback) real = opt.fallback(data, opt)</div><div class="line">    <span class="keyword">return</span> real</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 新增cookie</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</div><div class="line">    <span class="keyword">var</span> val = data[key]</div><div class="line">    <span class="comment">// 当设置的值为undefined，或nulltoremove为true且设置的值为null时，将expired设为true</span></div><div class="line">    <span class="comment">// 准备用于清除cookie值</span></div><div class="line">    <span class="keyword">var</span> expired = <span class="keyword">typeof</span> val === <span class="string">'undefined'</span> || (opt.nulltoremove &amp;&amp; val === <span class="literal">null</span>)</div><div class="line">    <span class="comment">// autojson为true时，将object转为json字串</span></div><div class="line">    <span class="comment">// 若不转为字串，object将会以'[object Object]'存入cookie</span></div><div class="line">    <span class="keyword">var</span> str = opt.autojson ? <span class="built_in">JSON</span>.stringify(val) : val</div><div class="line">    <span class="comment">// 是否对uri自动进行编码</span></div><div class="line">    <span class="keyword">var</span> encoded = opt.autoencode ? opt.encode(str) : str</div><div class="line">    <span class="comment">// 如果expired为true，将cookie设空，以清除cookie</span></div><div class="line">    <span class="keyword">if</span> (expired) encoded = <span class="string">''</span></div><div class="line">    <span class="comment">// 连接cookie的key,value以及各项设置</span></div><div class="line">    <span class="keyword">var</span> res = opt.encode(key) + <span class="string">'='</span> + encoded +</div><div class="line">      (opt.expires ? (<span class="string">';expires='</span> + expires(expired ? <span class="number">-10000</span> : opt.expires)) : <span class="string">''</span>) +</div><div class="line">      <span class="string">';path='</span> + opt.path +</div><div class="line">      (opt.domain ? (<span class="string">';domain='</span> + opt.domain) : <span class="string">''</span>) +</div><div class="line">      (opt.secure ? <span class="string">';secure'</span> : <span class="string">''</span>)</div><div class="line">    <span class="comment">// 如果opt中有test方法，执行test方法</span></div><div class="line">    <span class="keyword">if</span> (opt.test) opt.test(res)</div><div class="line">    <span class="comment">// 种入cookie</span></div><div class="line">    <span class="built_in">document</span>.cookie = res</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 返回cookies，能做到如下串联调用</span></div><div class="line">  <span class="built_in">console</span>.log(cookies)</div><div class="line">  <span class="keyword">return</span> cookies</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 模块化相关</span></div><div class="line">(<span class="function"><span class="keyword">function</span> <span class="title">webpackUniversalModuleDefinition</span> (<span class="params">root</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">'object'</span>) &#123;</div><div class="line">    <span class="built_in">module</span>.exports = cookies</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">    define(<span class="string">'cookies'</span>, [], cookies)</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</div><div class="line">    exports[<span class="string">'cookies'</span>] = cookies</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    root[<span class="string">'cookies'</span>] = cookies</div><div class="line">  &#125;</div><div class="line">&#125;)(<span class="keyword">this</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Set it</span></div><div class="line">cookies(&#123; <span class="attr">token</span>: <span class="string">'42'</span> &#125;)</div><div class="line"><span class="comment">// Get it</span></div><div class="line"><span class="keyword">var</span> token = cookies(<span class="string">'token'</span>)</div><div class="line"><span class="comment">// Eat it</span></div><div class="line">cookies(&#123; <span class="attr">token</span>: <span class="literal">null</span> &#125;)</div><div class="line">cookies(&#123; <span class="attr">token</span>: <span class="string">'42'</span> &#125;, &#123;</div><div class="line">  <span class="attr">expires</span>: <span class="number">100</span> * <span class="number">24</span> * <span class="number">3600</span>,     <span class="comment">// The time to expire in seconds</span></div><div class="line">  domain: <span class="literal">false</span>,                <span class="comment">// The domain for the cookie</span></div><div class="line">  path: <span class="string">'/'</span>,                    <span class="comment">// The path for the cookie</span></div><div class="line">  secure: https ? <span class="literal">true</span> : <span class="literal">false</span>  <span class="comment">// Require the use of https</span></div><div class="line">&#125;);</div><div class="line">cookies.expires = <span class="number">100</span> * <span class="number">24</span> * <span class="number">3600</span>;      <span class="comment">// The time to expire in seconds</span></div><div class="line">cookies.domain = <span class="literal">false</span>;                 <span class="comment">// The domain for the cookie</span></div><div class="line">cookies.path = <span class="string">'/'</span>;                     <span class="comment">// The path for the cookie</span></div><div class="line">cookies.secure = https ? <span class="literal">true</span> : <span class="literal">false</span>;  <span class="comment">// Require the use of https</span></div></pre></td></tr></table></figure>
<h2 id="CookieUtil"><a href="#CookieUtil" class="headerlink" title="CookieUtil"></a>CookieUtil</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> CookieUtil = &#123;</div><div class="line">  <span class="comment">// 获取</span></div><div class="line">  get: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> cookieName = <span class="built_in">encodeURIComponent</span>(name) + <span class="string">'='</span>,</div><div class="line">      cookieStart = <span class="built_in">document</span>.cookie.indexOf(cookieName),</div><div class="line">      cookieValue = <span class="literal">null</span></div><div class="line">    <span class="keyword">if</span> (cookieStart &gt; <span class="number">-1</span>) &#123;</div><div class="line">      <span class="keyword">var</span> cookieEnd = <span class="built_in">document</span>.cookie.indexOf(<span class="string">';'</span>, cookieStart)</div><div class="line">      <span class="keyword">if</span> (cookieEnd == <span class="number">-1</span>) &#123;</div><div class="line">        <span class="keyword">var</span> cookieEnd = <span class="built_in">document</span>.cookie.length</div><div class="line">      &#125;</div><div class="line">      cookieValue = <span class="built_in">decodeURIComponent</span>(<span class="built_in">document</span>.cookie.substring(cookieStart + cookieName.length, cookieEnd))</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> cookieValue</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// 获取</span></div><div class="line">  gets: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> cookies = <span class="built_in">document</span>.cookie.split(<span class="string">';'</span>)</div><div class="line">    <span class="keyword">let</span> cookiesObj = &#123;&#125;</div><div class="line">    cookies.forEach(<span class="function"><span class="params">c</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">if</span> (!c) &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">      &#125;</div><div class="line">      <span class="keyword">let</span> cs = c.trim().split(<span class="string">'='</span>)</div><div class="line">      <span class="keyword">if</span> (cs.length &lt; <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">      &#125;</div><div class="line">      <span class="keyword">let</span> key = cs[<span class="number">0</span>]</div><div class="line">      <span class="keyword">let</span> value = cs[<span class="number">1</span>]</div><div class="line">      <span class="keyword">if</span>(value == <span class="string">'""'</span>)&#123;</div><div class="line">        value = <span class="string">""</span></div><div class="line">      &#125;</div><div class="line">      cookiesObj[key] = value</div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">return</span> cookiesObj[name]</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// 设置</span></div><div class="line">  set: <span class="function"><span class="keyword">function</span> (<span class="params">name, value, expires, path, domain, secure</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> cookieText = <span class="built_in">encodeURIComponent</span>(name) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(value)</div><div class="line">    <span class="keyword">if</span> (expires <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</div><div class="line">      cookieText += <span class="string">'; expires='</span> + expires.toGMTString()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (path) &#123;</div><div class="line">      cookieText += <span class="string">'; path='</span> + path</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (domain) &#123;</div><div class="line">      cookieText += <span class="string">'; domain='</span> + domain</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (secure) &#123;</div><div class="line">      cookieText += <span class="string">'; secure'</span></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">document</span>.cookie = cookieText</div><div class="line">  &#125;,</div><div class="line">  <span class="comment">// 删除</span></div><div class="line">  unset: <span class="function"><span class="keyword">function</span> (<span class="params">name, path, domain, secure</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.set(name, <span class="string">''</span>, <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>), path, domain, secure)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 设置cookie</span></div><div class="line">CookieUtil.set(<span class="string">"name"</span>, <span class="string">"Nicholas"</span>)</div><div class="line">CookieUtil.set(<span class="string">"book"</span>, <span class="string">"Professional JavaScript"</span>)</div><div class="line"><span class="comment">// 读取cookie的值</span></div><div class="line">alert(CookieUtil.get(<span class="string">"name"</span>)); <span class="comment">//"Nicholas"</span></div><div class="line">alert(CookieUtil.get(<span class="string">"book"</span>)); <span class="comment">//"Professional JavaScript"</span></div><div class="line"><span class="comment">// 删除cookie</span></div><div class="line">CookieUtil.unset(<span class="string">"name"</span>)</div><div class="line">CookieUtil.unset(<span class="string">"book"</span>);</div></pre></td></tr></table></figure>
<h2 id="SubCookieUtil"><a href="#SubCookieUtil" class="headerlink" title="SubCookieUtil"></a>SubCookieUtil</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> SubCookieUtil = &#123;</div><div class="line">  <span class="attr">get</span>: <span class="function"><span class="keyword">function</span> (<span class="params">name, subName</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> subCookies = <span class="keyword">this</span>.getAll(name);</div><div class="line">    <span class="keyword">if</span> (subCookies) &#123;</div><div class="line">      <span class="keyword">return</span> subCookies[subName];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">getAll</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> cookieName = <span class="built_in">encodeURIComponent</span>(name) + <span class="string">"="</span>,</div><div class="line">      cookieStart = <span class="built_in">document</span>.cookie.indexOf(cookieName),</div><div class="line">      cookieValue = <span class="literal">null</span>,</div><div class="line">      cookieEnd,</div><div class="line">      subCookies, <span class="number">11</span> i,</div><div class="line">      parts,</div><div class="line">      result = &#123;&#125;;</div><div class="line">    <span class="keyword">if</span> (cookieStart &gt; <span class="number">-1</span>)&#123;</div><div class="line">      cookieEnd = <span class="built_in">document</span>.cookie.indexOf(<span class="string">";"</span>, cookieStart);</div><div class="line">      <span class="keyword">if</span> (cookieEnd == <span class="number">-1</span>)&#123;</div><div class="line">        cookieEnd = <span class="built_in">document</span>.cookie.length;</div><div class="line">      &#125;</div><div class="line">      cookieValue = <span class="built_in">document</span>.cookie.substring(cookieStart + cookieName.length, cookieEnd);</div><div class="line">      <span class="keyword">if</span> (cookieValue.length &gt; <span class="number">0</span>)&#123;</div><div class="line">        subCookies = cookieValue.split(<span class="string">"&amp;"</span>);</div><div class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>, len=subCookies.length; i &lt; len; i++)&#123;</div><div class="line">          parts = subCookies[i].split(<span class="string">"="</span>);</div><div class="line">          result[<span class="built_in">decodeURIComponent</span>(parts[<span class="number">0</span>])] = <span class="built_in">decodeURIComponent</span>(parts[<span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">set</span>: <span class="function"><span class="keyword">function</span> (<span class="params">name, subName, value, expires, path, domain, secure</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> subcookies = <span class="keyword">this</span>.getAll(name) || &#123;&#125;;</div><div class="line">    <span class="keyword">this</span>.setAll(name, subcookies, expires, path, domain, secure);</div><div class="line">    subcookies[subName] = value;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">setAll</span>: <span class="function"><span class="keyword">function</span>(<span class="params">name, subcookies, expires, path, domain, secure</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> cookieText = <span class="built_in">encodeURIComponent</span>(name) + <span class="string">"="</span>,</div><div class="line">      subcookieParts = <span class="keyword">new</span> <span class="built_in">Array</span>(),</div><div class="line">      subName;</div><div class="line">    <span class="keyword">for</span> (subName <span class="keyword">in</span> subcookies)&#123;</div><div class="line">      <span class="keyword">if</span> (subName.length &gt; <span class="number">0</span> &amp;&amp; subcookies.hasOwnProperty(subName))&#123;</div><div class="line">        subcookieParts.push(<span class="built_in">encodeURIComponent</span>(subName) + <span class="string">"="</span> +</div><div class="line">        <span class="built_in">encodeURIComponent</span>(subcookies[subName]));</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (cookieParts.length &gt; <span class="number">0</span>)&#123;</div><div class="line">      cookieText += subcookieParts.join(<span class="string">"&amp;"</span>);</div><div class="line">      <span class="keyword">if</span> (expires <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</div><div class="line">        cookieText += <span class="string">"; expires="</span> + expires.toGMTString();</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (path) &#123;</div><div class="line">        cookieText += <span class="string">"; path="</span> + path;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (domain) &#123;</div><div class="line">        cookieText += <span class="string">"; domain="</span> + domain;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (secure) &#123;</div><div class="line">        cookieText += <span class="string">"; secure"</span>;</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      cookieText += <span class="string">"; expires="</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">0</span>)).toGMTString();</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">document</span>.cookie = cookieText;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h1 id="Web-Storage存储机制"><a href="#Web-Storage存储机制" class="headerlink" title="Web Storage存储机制"></a>Web Storage存储机制</h1><p>两种存储数据的对象：sessionStorage、localStorage<br>sessionStorage：严格用于一个浏览器会话中存储数据，应为数据在关闭浏览器后会立即删除。<br>localStorage：用于跨会话持久化数据，并遵循跨域安全策略。</p>
<p>原因：</p>
<ol>
<li>提供一种在Cookie之外存储数据的途径</li>
<li>提供一种存储大量可以跨会话存在的数据机制</li>
</ol>
<h2 id="sessionStorage"><a href="#sessionStorage" class="headerlink" title="sessionStorage"></a>sessionStorage</h2><p>Local Storage 是 Web Storage API 的一种类型，能在浏览器端存储键值对数据。<br>Local Storage 因提供了更直观和安全的API来存储简单的数据，被视为替代 Cookies 的一种解决方案。<br>从技术上说，尽管 Local Storage 只能存储字符串，但是它也是可以存储字符串化的JSON数据。这就意味着，Local Storage 能比 Cookies 存储更复杂的数据。</p>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 使用方法存储数据</span></div><div class="line">sessionStorage.setItem(<span class="string">'name'</span>, <span class="string">'Nicholas'</span>)</div><div class="line"><span class="comment">// 使用属性存储数据</span></div><div class="line">sessionStorage.book = <span class="string">'Professional JavaScript'</span></div><div class="line"></div><div class="line"><span class="comment">// 使用方法读取数据</span></div><div class="line"><span class="keyword">var</span> name = sessionStorage.getItem(<span class="string">'name'</span>)</div><div class="line"><span class="comment">// 使用属性读取数据</span></div><div class="line"><span class="keyword">var</span> book = sessionStorage.book</div><div class="line"></div><div class="line"><span class="comment">// 使用方法删除数据</span></div><div class="line">sessionStorage.removeItem(<span class="string">'name'</span>)</div><div class="line"><span class="comment">// 使用delete删除数据</span></div><div class="line"><span class="keyword">delete</span> sessionStorage.name</div><div class="line"></div><div class="line"><span class="comment">// 使用方法获取Key</span></div><div class="line">sessionStorage.key(<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="comment">// 使用方法删除所有（Firefox没有）</span></div><div class="line">sessionStorage.clear()</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>Nicholas</td>
</tr>
<tr>
<td>book</td>
<td>Professional JavaScript</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IE8</span></div><div class="line">sessionStorage.begin()</div><div class="line">sessionStorage.name = <span class="string">'Nicholas'</span></div><div class="line">sessionStorage.book = <span class="string">'Professional JavaScript'</span></div><div class="line">sessionStorage.commit()</div></pre></td></tr></table></figure>
<h2 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h2><p>Local Storage 补充一点，当浏览器处于无痕浏览时，不会缓存任何数据</p>
<h3 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 使用方法存储数据</span></div><div class="line">localStorage.setItem(<span class="string">'name'</span>, <span class="string">'Nicholas'</span>)</div><div class="line"><span class="comment">// 使用属性存储数据</span></div><div class="line">localStorage.book = <span class="string">'Professional JavaScript'</span></div><div class="line"></div><div class="line"><span class="comment">// 使用方法读取数据</span></div><div class="line"><span class="keyword">var</span> name = localStorage.getItem(<span class="string">'name'</span>)</div><div class="line"><span class="comment">// 使用属性读取数据</span></div><div class="line"><span class="keyword">var</span> book = localStorage.book</div><div class="line"></div><div class="line"><span class="comment">// 使用方法删除数据</span></div><div class="line">localStorage.removeItem(<span class="string">'name'</span>)</div><div class="line"></div><div class="line"><span class="comment">// 使用方法获取Key</span></div><div class="line">localStorage.key(<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="comment">// 使用方法删除所有（Firefox没有）</span></div><div class="line">localStorage.clear()</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>Nicholas</td>
</tr>
<tr>
<td>book</td>
<td>Professional JavaScript</td>
</tr>
</tbody>
</table>
<h3 id="兼容globalStorage"><a href="#兼容globalStorage" class="headerlink" title="兼容globalStorage"></a>兼容globalStorage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLocalStorage</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> localStorage == <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="keyword">return</span> localStorage</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> globalStorage == <span class="string">'object'</span>) &#123;</div><div class="line">        <span class="keyword">return</span> globalStorage[location.host]</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">    	<span class="comment">// 抛出异常</span></div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Local storage not available.'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> storage = getLocalStorage()</div><div class="line">storage.setItem(<span class="string">'named'</span>, <span class="string">'Nicholasd'</span>)</div></pre></td></tr></table></figure>
<h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><p>对存储空间大小的限制都是以每个来源（协议、域、端口）为单位的。每个来源都有固定大小的空间用于保存自己的数据。</p>
<ol>
<li>localStorage大多数浏览器每个来源5MB限制，Chrome、Safari、IOSSafari、AndroidWebkit为2.5MB，</li>
<li>sessionStorage的Chrome、Safari、iOSSafari、AndroidWebKit为2.5MB，IE8+、Opera为5MB</li>
<li>Local Storage 补充一点，当浏览器处于无痕浏览时，不会缓存任何数据</li>
</ol>
<ul>
<li><a href="http://dev-test.nemikor.com/web-storage/support-test/" target="_blank" rel="external">Web Storage Support Test</a></li>
</ul>
<h2 id="globalStorage"><a href="#globalStorage" class="headerlink" title="globalStorage"></a>globalStorage</h2><p>globalStorage对象不是Storage的实例，而具体globalStorage[‘wrox.com’]。</p>
<h3 id="基本操作-2"><a href="#基本操作-2" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 存储数据</span></div><div class="line">globalStorage[<span class="string">'wrox.com'</span>].name = <span class="string">'Nicholas'</span></div><div class="line"></div><div class="line"><span class="comment">// 读取数据</span></div><div class="line"><span class="keyword">var</span> name = globalStorage[<span class="string">'wrox.com'</span>].name</div><div class="line"></div><div class="line"><span class="comment">// 可以让任何以net结尾的域名访问</span></div><div class="line">globalStorage[<span class="string">'net'</span>].name = <span class="string">'Nicholas'</span></div><div class="line"><span class="comment">// 可以让任何人访问</span></div><div class="line">globalStorage[<span class="string">''</span>].name = <span class="string">'Nicholas'</span></div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>Nicholas</td>
</tr>
<tr>
<td>book</td>
<td>Professional JavaScript</td>
</tr>
</tbody>
</table>
<h2 id="storage事件"><a href="#storage事件" class="headerlink" title="storage事件"></a>storage事件</h2><p>对Storage对象进行任何修改，都会在文档上触发storage事件。<br>遗憾的是，webkit（chrome）还不支持这个事件，尽管 IE8 以及 ff 支持其部分属性，但因为 chrome 的不支持，注定其到目前为止还无法广泛使用</p>
<h3 id="event对象"><a href="#event对象" class="headerlink" title="event对象"></a>event对象</h3><p>key: 设置或删除的键名<br>oldValue: 键被更改之前的值<br>newValue: 如果是设置值，则是新值；如果是删除键，则是null<br>url*: key改变发生的URL</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'storage'</span>.function(event)&#123;</div><div class="line">  <span class="keyword">var</span> output = <span class="built_in">document</span>.getElementById(<span class="string">"output"</span>)</div><div class="line">  output.innerHTML += <span class="string">"原有值："</span> + event.oldValue</div><div class="line">  output.innerHTML += <span class="string">"&lt;br/&gt;新值："</span> + event.newValue</div><div class="line">  output.innerHTML += <span class="string">"&lt;br/&gt;变动页面地址："</span> + utf8_decode(<span class="built_in">unescape</span>(event.url))</div><div class="line">  <span class="built_in">console</span>.log(event.storageArea)</div><div class="line">  <span class="comment">// 此行代码只能在chrome浏览器中有效  </span></div><div class="line">  <span class="built_in">console</span>.log(event.storageArea === localStorage)</div><div class="line">  <span class="comment">// 输出true</span></div><div class="line">&#125;)</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">utf8_decode</span>(<span class="params">utfText</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> string = <span class="string">""</span></div><div class="line">  <span class="keyword">var</span> i = <span class="number">0</span></div><div class="line">  <span class="keyword">var</span> c = c1 = c2= <span class="number">0</span></div><div class="line">  <span class="keyword">while</span>(i &lt; utfText.length) &#123;</div><div class="line">    c = utfText.charCodeAt(i)</div><div class="line">    <span class="keyword">if</span> (c &lt;<span class="number">128</span>) &#123;</div><div class="line">      string += <span class="built_in">String</span>.fromCharCode(c)</div><div class="line">      i++</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((c &gt; <span class="number">191</span>) &amp;&amp; (c &lt; <span class="number">224</span>)) &#123;</div><div class="line">      c2 = utfText.charCodeAt(i+<span class="number">1</span>)</div><div class="line">      string += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">31</span>) &lt;&lt; <span class="number">6</span>) | (c2 &amp; <span class="number">63</span>))</div><div class="line">      i += <span class="number">2</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      c2 = utfText.charCodeAt(i+<span class="number">1</span>)</div><div class="line">      c3 = utfText.charCodeAt(i+<span class="number">2</span>)</div><div class="line">      string += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">15</span>) &lt;&lt; <span class="number">12</span>) | ((c2 &amp; <span class="number">63</span>) &lt;&lt; <span class="number">6</span>) | (c3 &amp; <span class="number">63</span>))</div><div class="line">      i += <span class="number">3</span></div><div class="line">    &#125;</div><div class="line">  &#125;  </div><div class="line">  <span class="keyword">return</span> string</div><div class="line">&#125;</div><div class="line"></div><div class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'storage'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">    alert(<span class="string">'Storage changed for '</span> + event.domain);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>如何使localStorage变更事件在当前页响应?<br>监听storage变更事件会发现，当数据发生变化时本页是监听不到storage事件变更消息的。而同域的其他打开的页面反而监听到了该消息。<br>在firefox和chrome中存储和读取都是正常的, 但是对storage事件的触发似乎有点问题, 自身页面进行setItem后没有触发window的storage事件, 但是同时访问A.html和B.html, 在A页面中进行 setItem能触发B页面中window的storage事件, 同样的在B页面中进行setItem能触发A页面中window的storage事件. 在IE9中, 页面自身的设值能触发当前页面的storage事件,同样当前页面的设值能触发同一”起源”下其他页面window的storage事件,这看起来似乎更让人想的通些.</p>
<p>直接打开两个链接：</p>
<ul>
<li><a href="http://www.css88.com/demo/sessionStorage/index2.html" target="_blank" rel="external">storage事件1</a></li>
<li><a href="http://www.css88.com/demo/sessionStorage/index3.html" target="_blank" rel="external">storage事件2</a></li>
</ul>
<h3 id="自定义监听"><a href="#自定义监听" class="headerlink" title="自定义监听"></a>自定义监听</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> oriSetItem = localStorage.setItem</div><div class="line">localStorage.setItem = <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</div><div class="line">    <span class="comment">// 这里抛出自定义事件</span></div><div class="line">    <span class="keyword">var</span> event = <span class="keyword">new</span> Event(<span class="string">'setItemEvent'</span>)</div><div class="line">    event.newValue = value</div><div class="line">    <span class="built_in">window</span>.dispatchEvent(event)</div><div class="line">    <span class="comment">// 实现原方法</span></div><div class="line">    oriSetItem.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</div><div class="line">&#125;</div><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'setItemEvent'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'本地存储已变化，新值为'</span> + e.newValue)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> oriSetItem = localStorage.setItem</div><div class="line">localStorage.setItem = <span class="function"><span class="keyword">function</span>(<span class="params">k, v</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> se = <span class="built_in">document</span>.createEvent(<span class="string">'StorageEvent'</span>)</div><div class="line">	se.initStorageEvent(<span class="string">'storage'</span>, <span class="literal">false</span>, <span class="literal">false</span>, k, <span class="literal">null</span>, v, <span class="literal">null</span>, <span class="literal">null</span>)</div><div class="line">	<span class="built_in">window</span>.dispatchEvent(se)</div><div class="line">	oriSetItem.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><a href="http://www.cnblogs.com/AndyWithPassion/archive/2011/07/04/html5_localstorage.html" target="_blank" rel="external">初试WebStorage之localstorage</a></li>
</ul>
<h1 id="cookie、sessionStorage和localStorage的区别"><a href="#cookie、sessionStorage和localStorage的区别" class="headerlink" title="cookie、sessionStorage和localStorage的区别"></a>cookie、sessionStorage和localStorage的区别</h1><h2 id="存储时效"><a href="#存储时效" class="headerlink" title="存储时效"></a>存储时效</h2><ol>
<li>cookie可以手动设置失效期，默认为会话级</li>
<li>sessionStorage的存储时长是会话级</li>
<li>localStorage的存储时长是永久，除非用户手动利用浏览器的工具删除</li>
</ol>
<h2 id="访问的局限性"><a href="#访问的局限性" class="headerlink" title="访问的局限性"></a>访问的局限性</h2><ol>
<li>cookie可以设置路径path，所有他要比另外两个多了一层访问限制</li>
<li>localStorage和sessionStorage的访问限制是文档源级别，即协议、主机名和端口</li>
<li>还要注意的是，cookie可以通过设置domain属性值，可以不同二级域名下共享cookie，而Storage不可以，比如<a href="http://image.baidu.com的cookie" target="_blank" rel="external">http://image.baidu.com的cookie</a> <a href="http://map.baidu.com是可以访问的，前提是Cookie的domain设置为&quot;.http://baidu.com&quot;，而Storage是不可以的（这个很容易实验，就不细说了）" target="_blank" rel="external">http://map.baidu.com是可以访问的，前提是Cookie的domain设置为&quot;.http://baidu.com&quot;，而Storage是不可以的（这个很容易实验，就不细说了）</a></li>
</ol>
<h2 id="存储大小限制"><a href="#存储大小限制" class="headerlink" title="存储大小限制"></a>存储大小限制</h2><ol>
<li>cookie适合存储少量数据，他的大小限制是个数进行限制，每个浏览器的限制数量不同</li>
<li>Storage的可以存储数据的量较大，此外他是通过占用空间大小来做限制的，每个浏览器的实现也是不同的，大家可以看这篇文章来进一进步了解<a href="http://dev-test.nemikor.com/web-storage/support-test/" target="_blank" rel="external">Web Storage Support Test</a></li>
</ol>
<h2 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h2><ol>
<li>cookie是作为document的属性存在，并没有提供标准的方法来直接操作cookie</li>
<li>Storage提供了setItem()和getItem()还有removeItem()方法，操作方便不易出错</li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>cookie在发送http请求时，会将本地的cookie作为http头部信息传递给服务器</li>
<li>cookie可以由服务器通过http来设定</li>
</ol>
<h1 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h1><p>是一种类似SQL数据库的结构化数据机制。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/25/Induce/JavaScript/Base/PWA/PWA/" rel="next" title="PWA简介 - 下一代 Web 应用？">
                <i class="fa fa-chevron-left"></i> PWA简介 - 下一代 Web 应用？
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/25/Induce/JavaScript/Base/cacheStorage/" rel="prev" title="JavaScript 借助Service Worker和cacheStorage缓存及离线开发">
                JavaScript 借助Service Worker和cacheStorage缓存及离线开发 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="世平阜康" />
          <p class="site-author-name" itemprop="name">世平阜康</p>
           
              <p class="site-description motion-element" itemprop="description">luuman，90后，水瓶座普通男青年！爱折腾，爱运动，更爱游离于错综复杂的编码与逻辑中，无法自拔。相信编程是一门艺术，自诩为游弋在代码里的人生。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">226</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">67</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#概况"><span class="nav-number">1.</span> <span class="nav-text">概况</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#离线检测"><span class="nav-number">2.</span> <span class="nav-text">离线检测</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#navigator-onLine"><span class="nav-number">2.1.</span> <span class="nav-text">navigator.onLine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络判断"><span class="nav-number">2.2.</span> <span class="nav-text">网络判断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事件判断"><span class="nav-number">2.2.1.</span> <span class="nav-text">事件判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图片轮询"><span class="nav-number">2.2.2.</span> <span class="nav-text">图片轮询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ajax轮询"><span class="nav-number">2.2.3.</span> <span class="nav-text">Ajax轮询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#应用缓存（已废弃）"><span class="nav-number">3.</span> <span class="nav-text">应用缓存（已废弃）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据存储"><span class="nav-number">4.</span> <span class="nav-text">数据存储</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie"><span class="nav-number">4.1.</span> <span class="nav-text">cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#构成"><span class="nav-number">4.1.1.</span> <span class="nav-text">构成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#操作"><span class="nav-number">4.1.2.</span> <span class="nav-text">操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP专有cookie"><span class="nav-number">4.1.3.</span> <span class="nav-text">HTTP专有cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优点"><span class="nav-number">4.1.4.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缺点"><span class="nav-number">4.1.5.</span> <span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cookies-js"><span class="nav-number">4.2.</span> <span class="nav-text">cookies.js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CookieUtil"><span class="nav-number">4.3.</span> <span class="nav-text">CookieUtil</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SubCookieUtil"><span class="nav-number">4.4.</span> <span class="nav-text">SubCookieUtil</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web-Storage存储机制"><span class="nav-number">5.</span> <span class="nav-text">Web Storage存储机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sessionStorage"><span class="nav-number">5.1.</span> <span class="nav-text">sessionStorage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本操作"><span class="nav-number">5.1.1.</span> <span class="nav-text">基本操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#localStorage"><span class="nav-number">5.2.</span> <span class="nav-text">localStorage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本操作-1"><span class="nav-number">5.2.1.</span> <span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#兼容globalStorage"><span class="nav-number">5.2.2.</span> <span class="nav-text">兼容globalStorage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#限制"><span class="nav-number">5.3.</span> <span class="nav-text">限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#globalStorage"><span class="nav-number">5.4.</span> <span class="nav-text">globalStorage</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本操作-2"><span class="nav-number">5.4.1.</span> <span class="nav-text">基本操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#storage事件"><span class="nav-number">5.5.</span> <span class="nav-text">storage事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#event对象"><span class="nav-number">5.5.1.</span> <span class="nav-text">event对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#问题"><span class="nav-number">5.5.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义监听"><span class="nav-number">5.5.3.</span> <span class="nav-text">自定义监听</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cookie、sessionStorage和localStorage的区别"><span class="nav-number">6.</span> <span class="nav-text">cookie、sessionStorage和localStorage的区别</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#存储时效"><span class="nav-number">6.1.</span> <span class="nav-text">存储时效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#访问的局限性"><span class="nav-number">6.2.</span> <span class="nav-text">访问的局限性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储大小限制"><span class="nav-number">6.3.</span> <span class="nav-text">存储大小限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#操作方法"><span class="nav-number">6.4.</span> <span class="nav-text">操作方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">6.5.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IndexedDB"><span class="nav-number">7.</span> <span class="nav-text">IndexedDB</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">世平阜康</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  






  





  

  

  

  

</body>
</html>
